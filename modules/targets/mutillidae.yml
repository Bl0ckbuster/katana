---

name: mutillidae
category: targets
description: Test lab focused on OWASP top 10 vulnerabilities.
href: https://mutillidae.test:8443

install:
  - service:
      name: docker
      state: running
  - docker:
      name: mutillidae
      image: bit0pus/docker-mutillidae
      ports:
        80/tcp: 33081
        22/tcp: 22222
        3306/tcp: 33333

  - name: Setup hosts file entry (test)
    lineinfile:
      dest: /etc/hosts
      line: '127.0.0.1   mutillidae.test'

  - name: Setup nginx reverse-proxy config
    reverseproxy:
      hostname: 'mutillidae.test'
      proxy_pass: 'http://localhost:33081'

  - service:
      name: nginx
      state: restarted

remove:
  - service:
      name: docker
      state: running
  - docker:
      name: mutillidae
  - name: Remove hosts file entry (test)
    lineinfile:
      dest: /etc/hosts
      line: '127.0.0.1   mutillidae.test'
      state: absent
  - name: Remove nginx reverse-proxy config
    reverseproxy:
      hostname: 'mutillidae.test'

start:
  - service:
      name: docker
      state: running
  - docker:
      name: mutillidae

stop:
  - service:
      name: docker
      state: running
  - docker:
      name: mutillidae

status:
  running:
    started:
      docker: mutillidae
  installed:
    exists:
      docker: mutillidae

